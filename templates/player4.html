<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Player 4</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/socket.io/3.0.3/socket.io.js"></script>
    <script src="https://code.jquery.com/jquery-3.5.1.min.js"></script>
    <style>
        .board {
            border: 1px solid black;
            padding: 10px;
            margin-bottom: 10px;
        }
        .other-player-board {
            border: 1px solid black;
            padding: 10px;
            margin-bottom: 10px;
        }
        .deck {
            border: 1px solid black;
            padding: 10px;
        }
    </style>
</head>
<body>
    <h1>Player 4</h1>
    <button id="draw_deck1">Draw from Deck 1</button>
    <button id="draw_deck2">Draw from Deck 2</button>
    <button id="draw_character">Draw from Character's Deck</button>

    <div class="board">
        <h2>Your character</h2>
        <div id="character" class="deck"></div>
    </div>

    <div class="board">
        <h2>Your Deck from Deck 1</h2>
        <button id="shuffle_player_deck1">Shuffle Deck 1</button>
        <div id="deck1" class="deck"></div>
    </div>

    <div class="board">
        <h2>Your Deck from Deck 2</h2>
        <button id="shuffle_player_deck2">Shuffle Deck 2</button>
        <div id="deck2" class="deck"></div>
    </div>

    <div class="board">
        <h2>Your Board</h2>
        <div id="board"></div>
    </div>

    <div class="other-player-board">
        <h2>Other Players' Boards</h2>
        <div id="other_players_boards"></div>
    </div>

    <!-- Button to go to the trash page -->
    <button onclick="window.location.href='/trash'">View Trash</button>

    <script>
        $(document).ready(function() {
            var socket = io();
            var player_id = 4;

            $('#draw_deck1').click(function() {
                socket.emit('draw_card', { player_id: player_id, deck: 'deck1' });
            });

            $('#draw_deck2').click(function() {
                socket.emit('draw_card', { player_id: player_id, deck: 'deck2' });
            });

            $('#draw_character').click(function() {
                socket.emit('draw_card', { player_id: player_id, deck: 'character' });
            });

            socket.on('update', function(data) {
                var playerData = data.players['Player ' + player_id];
                $('#character').empty();
                playerData.character.forEach(function(card) {
                    var cardElement = `<div>${card}</div>`;
                    $('#character').append(cardElement);
                });
                $('#deck1').empty();
                playerData.deck1.forEach(function(card) {
                    var cardElement = `<div>${card}</div>`;
                    var useButton = `<button class="use-deck1-card" data-card="${card}">Use</button>`;
                    var sendButtons = generateSendButtons(card, 1);
                    var trashButton = `<button class="send-to-trash" data-card="${card}">Trash</button>`;
                    $('#deck1').append(cardElement + useButton + sendButtons + trashButton); // Append card, use button, send buttons, and trash button
                });
                $('#deck2').empty();
                playerData.deck2.forEach(function(card) {
                    var cardElement = `<div>${card}</div>`;
                    var sendButtons = generateSendButtons(card, 2);
                    var trashButton = `<button class="send-to-trash" data-card="${card}">Trash</button>`;
                    $('#deck2').append(cardElement + sendButtons + trashButton); // Append card, send buttons, and trash button
                });
                $('#board').empty();
                playerData.board.forEach(function(card) {
                    var cardElement = `<div>${card}</div>`;
                    var trashButton = `<button class="send-to-trash" data-card="${card}">Trash</button>`;
                    var moveButtonToDeck1 = `<button class="move-to-deck1" data-card="${card}">Move to Deck 1</button>`;
                    var moveButtonToDeck2 = `<button class="move-to-deck2" data-card="${card}">Move to Deck 2</button>`;
                    var sendButtons = generateSendButtons(card, "board");
                    var sendToDeck1 = `<button class="send_to_deck1" data-card="${card}">Send to Deck 1</button>`;
                    $('#board').append(cardElement + trashButton, moveButtonToDeck1, moveButtonToDeck2, sendButtons, sendToDeck1); // Append card, trash button, move to deck 1, move to deck 2 and sendButtons
                });

                $('#other_players_boards').empty();
                Object.keys(data.players).forEach(function(player) {
                    if (player !== 'Player ' + player_id) {
                        $('#other_players_boards').append(`<div class="other-player-board">`);
                        $('#other_players_boards').append(`<h3>${player}'s Board</h3>`);
                        data.players[player].board.forEach(function(card) {
                            $('#other_players_boards').append(`<div>${card}</div>`);
                        });
                        $('#other_players_boards').append(`</div>`);
                    }
                });
            });

            $('#shuffle_player_deck1').click(function() {
                socket.emit('shuffle_player_deck', { player_id: player_id, deck: 'deck1' });
            });

            $('#shuffle_player_deck2').click(function() {
                socket.emit('shuffle_player_deck', { player_id: player_id, deck: 'deck2' });
            });

            $(document).on('click', '.use-deck1-card', function() {
                var card = $(this).data('card');
                socket.emit('use_card', { player_id: player_id, card: card });
            });

            $(document).on('click', '.send-card', function() {
                var card = $(this).data('card');
                var targetPlayer = $(this).data('target-player');
                var targetDeck = $(this).data('target-deck');
                socket.emit('send_card', { player_id: player_id, card: card, target_player: targetPlayer, target_deck: targetDeck });
            });

            $(document).on('click', '.send-to-trash', function() {
                var card = $(this).data('card');
                socket.emit('send_card_to_trash', { player_id: player_id, card: card });
            });

            $(document).on('click', '.move-to-deck1', function() {
                var card = $(this).data('card');
                socket.emit('move_to_deck1', { player_id: player_id, card: card });
            });

            $(document).on('click', '.move-to-deck2', function() {
                var card = $(this).data('card');
                socket.emit('move_to_deck2', { player_id: player_id, card: card });
            });

            $(document).on('click', '.send_to_deck1', function() {
                var card = $(this).data('card');
                socket.emit('send_to_deck1', { player_id: player_id, card: card });
            });

            function generateSendButtons(card, deckNumber) {
                var sendButtons = '';
                for (var i = 1; i <= 6; i++) {
                    if (deckNumber == "board") {
                        if (i !== player_id) {
                            sendButtons += `<button class="send-card" data-card="${card}" data-target-player="${i}" data-target-deck="board">Send to Player ${i}</button>`;
                        }
                    }
                    else {
                        if (i !== player_id) {
                            sendButtons += `<button class="send-card" data-card="${card}" data-target-player="${i}" data-target-deck="deck${deckNumber}">Send to Player ${i}</button>`;
                        }
                    }                    
                }
                return sendButtons;
            }
        });
    </script>
</body>
</html>